HTSLIB_SOURCE_DIR=htslib-1.7

INCLUDE_DIR=${R_PACKAGE_DIR}/include
USRLIB_DIR=${R_PACKAGE_DIR}/usrlib${R_ARCH}

R_ETC_MAKECONF=${R_HOME}/etc${R_ARCH}/Makeconf

## Preprocessor options. Keep Rhtslib::pkgconfig() function (defined in
## R/zzz.R) in sync with this.
PKG_CPPFLAGS=-I"${INCLUDE_DIR}"

.PHONY: all htslib mk_include_dir mk_usrlib_dir install-include-stuff install-usrlib-stuff clean

all: install-usrlib-stuff install-include-stuff

htslib:
	cd "${HTSLIB_SOURCE_DIR}" && $(MAKE) -f "${R_ETC_MAKECONF}" -f "${HTSLIB_MAKEFILE}"

mk_include_dir:
	mkdir -p "${INCLUDE_DIR}"

mk_usrlib_dir:
	mkdir -p "${USRLIB_DIR}"

install-include-stuff: htslib mk_include_dir
	cd "${HTSLIB_SOURCE_DIR}/htslib" && cp * "${INCLUDE_DIR}"

clean:
	cd "${HTSLIB_SOURCE_DIR}" && $(MAKE) -f "${HTSLIB_MAKEFILE}" clean
